<div class="content">

<!-- /////////////////// BEACH PHOTO CAROUSEL //////////////////// -->

  <div class="show-banner">

    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
      <ol class="carousel-indicators">
        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
      </ol>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <%= cl_image_tag @ride.beach.photo.url, alt: "alttext" %>
        </div>
        <div class="carousel-item">
          <img class="d-block" src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1053&q=80" alt="Picture 2">
        </div>
        <div class="carousel-item">
          <%= cl_image_tag @ride.beach.photo.url, alt: "alttext" %>
        </div>
      </div>
      <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  </div>

</div>


<div class="show-ride-container">

  <!-- /////////////////// JOIN CARD LAYOUT //////////////////// -->

  <div class="show-join-card-sticky-container" >

    <div class="show-join-card-content-container">

      <div class="show-join-card-content">

        <h3 style="color:white; margin-bottom: 0px"><%=@ride.date.strftime('%A')%> <%=@ride.date.strftime('%d')%>/<%=@ride.date.strftime('%m').to_i%> <%=@ride.time_slot.downcase%> </h3>
      </div>

      <% if !user_signed_in? || current_user.rides.where(id: @ride.id).blank? %>

        <div class="show-join-card-content">
          <div>
            <div style="text-align: right" >
              <%= link_to ride_userrides_path(@ride), method: :post do  %>
                <button class="btn btn-warning" id="join-btn">JOIN RIDE</button>
              <% end %>
            </div>
          </div>
        </div>

      <% else %>

        <div class="show-join-card-content">
          <div>
            <%= link_to ride_userride_path(@ride), method: :delete do  %>
              <div style="text-align: right;" >
                <button class="btn btn-warning" id="join-btn" >CANCEL</button>
              </div>
            <% end %>
          </div>
        </div>

      <% end %>

    </div>


    <div class="show-join-card-content-container" id="surf-content" style="background: white;">

      <img src="https://image.flaticon.com/icons/png/512/2045/2045847.png" style="width:80px;">
      <div class="show-beach-card-review-content">
        <h2> Swell </h2>
        <h5> height: <%= @ride[:swell_height].round(2) %>m </h5>
        <h5> period: <%= @ride[:swell_period].round(2) %>s </h5>
        <h5> direction: <%= @ride[:swell_direction].round(2) %>Â° </h5>
      </div>

    </div>
    <div class="show-join-card-content-container" id="surf-content" style="background: white;">

      <img src="https://image.flaticon.com/icons/png/512/2045/2045893.png" style="width:80px">
      <div class="show-beach-card-review-content">
        <h2> Wind </h2>
        <h5> speed: <%= @ride[:wind_speed].round(2) %>km/h </h5>
        <h5> gust: <%= @ride[:wind_gust].round(2) %>km/h </h5>
        <h5> direction: <%= @ride[:wind_direction].round(2) %>Â° </h5>
      </div>

    </div>

  </div>

<!-- /////////////////// BEACH CARD LAYOUT //////////////////// -->

  <div class="show-beach-card-container">

    <div class="show-beach-card">
      <h2> <%= @ride.beach.name %> </h2>
      <p> Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Lorem ipsum dolor sit amet, consectetur adipiscing elit." </p>
    </div>

    <% if !user_signed_in? || current_user.rides.where(id: @ride.id).blank? %>

    <% else %>

      <div class="show-riders-container">

        <!-- /////////////////// RIDERS CARD //////////////////// -->

        <div class="show-beach-card">
          <h3>Riders</h3>
          <h4> <strong> <%= @ride.users.count - 1%> </strong> rider(s) also going :</h4>
          <% @ride.users.each do |user| %>
            <ul>
              <li style="list-style-type: none;">
                <p class="ml-3"><i class="fas fa-swimmer mr-3"></i><%= user.username %> ðŸ¤™</p>
              </li>
            </ul>
          <% end %>
        </div>

        <!-- /////////////////// CHAT-ROOM CARD //////////////////// -->

        <div class="show-beach-card" style="padding:8px;">
            <h3>Chat room</h3>
            <% if policy(Message).create? %>

              <div  class="pl-2" style="overflow: scroll;height: 120px;" id='messages'>
                <% @ride.messages.each do |message| %>
                  <%= render 'messages/show', message: message %>
                <% end %>
              </div>
              <div id="message-ajax">
               <%= render 'messages/form', ride: @ride, message: Message.new  %>
              </div>
            <% end %>
        </div>
      </div>

    <% end %>

    <div class="show-beach-card">
      <h3>Available services at this beach: </h3>
        <div class="show-beach-icons">
          <i class="fas fa-parking" id="show-beach-icon-on"></i>
          <i class="far fa-life-ring" id="show-beach-icon-on"></i>
          <i class="fas fa-shower" id="show-beach-icon-off"></i>
          <i class="fas fa-store" id="show-beach-icon-on"></i>
          <i class="fas fa-utensils" id="show-beach-icon-off"></i>
          <i class="fas fa-mug-hot" id="show-beach-icon-off"></i>
        </div>
    </div>

    <!-- /////////////////// REVIEWS CARD //////////////////// -->

    <div class="show-beach-card">
      <div class="row justify-content-between">
        <div>
          <h3 style="padding:0px 16px 0px 16px;"> Reviews (<%=@ride.beach.reviews.count%>)</h3>
          <div class="inline-stars">
            <% average = Review.where(beach_id: @ride.beach_id).average(:rating) %>
            <% average.round.times do %>
              <h2 id="inline-stars-big"> <i class="fas fa-star"></i></h2>
            <% end %>
            <% (5 - average.round).times do %>
              <h2 id="inline-stars-big"> <i class="far fa-star"></i></h2>
            <% end %>
          </div>
        </div>
        <% if policy(Review).create? %>
          <div >
            <%= link_to new_ride_review_path(@ride), method: :get do %>
              <button id="classic-btn">Add a review <i class="fas fa-pencil-alt"></i></button>
            <% end %>
          </div>
        <% end %>

      </div>

      <% @ride.beach.reviews.order(created_at: :desc).each do |review| %>
        <div class="show-beach-card-review">
          <img src="https://c-sf.smule.com/sf/s57/arr/66/7b/6e9f1098-7c27-4544-b459-f90d306a479f.jpg" class="avatar-medium-bordered">
          <div class="show-beach-card-review-content">
            <div class="inline-stars">
              <% (review.rating.to_i).times do %>
                <h2 id="inline-stars-small"> <i class="fas fa-star"></i></h2>
              <% end %>
              <% (5 - review.rating.to_i).times do %>
                <h2 id="inline-stars-small"> <i class="far fa-star"></i></h2>
              <% end %>
              <p id="rating-date"> <%= Time.at(review.created_at).strftime("%d/%m/%Y") %></p>
            </div>
            <h5><strong><%= review.user.username.capitalize %></strong> from <%= review.user.hometown %></h5>
            <p><%= review.description %></p>
          </div>
        </div>
      <% end %>
    </div>

    <!-- /////////////////// SURF INFO CARD //////////////////// -->

    <div class="show-beach-card">
      <div class="show-beach-card-review">
        <img src="https://image.flaticon.com/icons/png/512/2045/2045847.png" style="width:80px">
        <div class="show-beach-card-review-content">
          <h2> Swell </h2>
          <h5> height: <%= @ride[:swell_height].round(2) %>m </h5>
          <h5> period: <%= @ride[:swell_period].round(2) %>s </h5>
          <h5> direction: <%= @ride[:swell_direction].round(2) %>Â° </h5>
        </div>
      </div>
    </div>

    <div class="show-beach-card">
      <div class="show-beach-card-review">
        <img src="https://image.flaticon.com/icons/png/512/2045/2045893.png" style="width:80px">
        <div class="show-beach-card-review-content">
          <h2> Wind </h2>
          <h5> speed: <%= @ride[:wind_speed].round(2) %>km/h </h5>
          <h5> gust: <%= @ride[:wind_gust].round(2) %>km/h </h5>
          <h5> direction: <%= @ride[:wind_direction].round(2) %>Â° </h5>
        </div>
      </div>
    </div>

  </div>

</div>
